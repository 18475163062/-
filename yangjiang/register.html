<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=320,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" /> 
	<link rel="stylesheet" href="css/index.css">
	<script src="jq/jquery-1.9.1.min.js"></script>
	<script src="js/index.js"></script>
	<script src="js/register.js"></script>
<meta content="">   
</head>
<body>
	<div class="container">
		<div class="title">
			<!-- <div id="moveDiv" style="width: 170px;text-align: left; background: #eee;height: 100vh;position: absolute;left: -210px;top: 0px;padding-left: 30px;">
				<div>首页</div>
				<div>活动公告</div>
				<div>抽奖结果查询</div>
				<div>活动报道</div>
				<div>资源单位</div>
			</div> -->
			
			<div class="title_1">
				<div class="title_2_1">
					<span class="title_span" style="font-size: 22px;font-weight: 12px; font-family: '微软雅黑';"><a id="btn" onclick="showLeftMenu()">≡</a></span>
					<span  style="color: #4E96ED;padding-left: 5px; font-size: 24px;font-family: '微软雅黑'; font-weight: 12px;">阳江科普游</span>
				</div>

				<div id="cover-background" class="trans-backgorund" style="background-color:#666;opacity: 0.8;" onclick="hideCover()"></div>
				<!-- <div id="cover-background-trans" class="trans-backgorund-transparent" style="display: none;background-color:yellow;"></div> -->
				<div id="left-menu-box" style="background-color:#fff;" class="trans-left-menu left-menu-hide">
					<div style="height: 50%; overflow: auto;">
						<div id="left-menu">
								<div> 阳江科普游</div>
								<div><a href="activity_gengduo.html">首页</a></div>
								<div><a href="activity.html">活动公告</a> </div>
								<div><a href="enroll_selected.html">抽奖结果查询</a></div>
								<div><a href="activity_journalism.html">活动报道</a></div>
								<div><a href="resunit.html">资源单位</a></div>
								<div onclick="clearAllCookie();">退出</div>
						</div>
					</div>
				</div>

				<div class="title_2">
					
						<span style="color: #4E96ED; font-size: 24px;font-family: '微软雅黑'; font-weight: 12px;"><a style="color:#4E96ED;" href="activity_gengduo.html">阳江科普游</a></span>
						<span class="title_span"><a href="activity.html">活动公告</a></span>
					<span class="title_span"><a href="enroll_selected.html">抽签结果查询</a></span>
					<span class="title_span"><a href="activity_journalism.html">活动报道</a></span>
					<span class="title_span"><a href="resunit.html">资源单位</a></span>
				</div>
				<div class="title_3" >
					<span style="padding-right: 10px;"><a href="login.html" >登录</a></span>
					<!-- <span class="title_span" style="padding-right: 10px;"><a href="#" >注册</a></span> -->
				</div>
			</div>	
		</div>
		<div class="conten_register" style="clear: both">
			<div style="font-family: '微软雅黑'; font-weight: bold;font-size: 18px;">用户注册</div>
				<!-- <form id="post-form">
					<div>
						<span>用户名</span>
						<span><input type="text" name="uname"></span>
					</div>
					<div>
						<span>密码</span>
						<span>
							<input type="hidden" name="password">
							<input type="password" id="password">
						</span>
					</div>
					<div>
						<span>确认密码</span>
						<span>
							<input type="password" id="password-copy">

						</span>
					</div>
					<div>
						<span>姓名</span>
						<span><input type="text" name="realname"></span>
					</div>
					<div>
						<span>身份证</span>
						<span><input type="text" name="id_card"></span>
					</div>
					<div>
						<span>性别</span>
						<span>
							<label><input type="radio" name="gender" value="1" checked="checked">男</label>
							<label><input type="radio" name="gender" value="2">女</label>
						</span>
					</div>
					<div>
						<span>所属人群</span>
						<span>
							<select name="belonging">
								<option value="0"></option>
								<option value="1">青少年</option>
								<option value="2">城镇劳动者</option>
								<option value="3">农村居民</option>
								<option value="4">领导干部和公务员</option>
							</select>
						</span>
					</div>
					<div>
						<span>手机号</span>
						<span><input type="text" name="phone"></span>
					</div>
					<div>
						<span>联系地址</span>
						<span><input type="text" name="address"></span>
					</div>
					<div><input type="button" onclick="getPubKey()" value="注册"><a onclick="history.go(-1);">返回</a></div>
				</form> -->
				<form id="post-form">
						<table class="table-list table-full">
							<tr>
								<td class="span1">用户名</td>
								<td><input class="input-text-mobile" type="text" maxlength="32" name="uname"></td>
							</tr>
							<tr>
								<td>密码</td>
								<td>
									<input type="hidden" name="password">
									<input id="password" class="input-text-mobile" type="password">
								</td>
							</tr>
							<tr>
								<td>确认密码</td>
								<td><input id="password-copy"  class="input-text-mobile" type="password"></td>
							</tr>
							<tr>
								<td>姓名</td>
								<td><input class="input-text-mobile" type="text" name="realname" maxlength="32"></td>
							</tr>
							<tr>
								<td>身份证</td>
								<td><input class="input-text-mobile" type="text" name="id_card" maxlength="32"></td>
							</tr>
							<td>性别</td>
							<td>
								<input type="radio" name="gender" value="1" checked="checked">男
								<input type="radio" name="gender" value="2">女
							</td>
							<tr>
								<td>所属人群</td>
								<td>
									<select name="belonging">
											<option value="0"></option>
											<option value="1">青少年</option>
											<option value="2">城镇劳动者</option>
											<option value="3">农村居民</option>
											<option value="4">领导干部和公务员</option>
									</select>
								</td>
							</tr>
							<tr>
								<td>手机号</td>
								<td><input class="input-text-mobile" type="text" name="phone" maxlength="32"></td>
							</tr>
							<tr>
								<td>联系地址</td>
								<td><input class="input-text-mobile" type="text" name="address" maxlength="32"></td>
							</tr>
							<tr>
								<td></td>
								<td>
									<a name="submit-btn" class="btn-input btn-select-custom" onclick="getPubKey()">注册</a>
									<a class="btn-input btn-cancel" onclick="history.go(-1);">返回</a>
								</td>
							</tr>
						</table>
					</form>
		</div>
		
	</div>
	<script src="jq/jsencrypt.min.js"></script>
	<script type="text/javascript">

        var submitBtn = $("#post-form a[name=submit-btn]");
        var registerXhr;

        function getPubKey() {
            if (registerXhr != null) return;
            registerXhr = $.ajax({
                url: "http://192.168.0.140:8090/api/user/pubkey",
                type: "post",
                // data: urlEncode(getPartJson(item)),
                dataType: "json",
				cache: false,
				xhrFields: {withCredentials: true},
                beforeSend: function () {
                    submitBtn.addClass("btn-submit");
                },
                complete: function () {
                },
                success: function (result) {
                    if (result.code == 200) {
                        var encrypt = new JSEncrypt();
                        encrypt.setPublicKey(result.data);

                        var post_form = $("#post-form");
                        var pwd = post_form.find("#password").val();
                        var pwdCopy = post_form.find("#password-copy").val();
                        if (pwd != pwdCopy) {
                            registerXhr = null;
                            submitBtn.removeClass("btn-submit");
                            return alert("两次输入的新密码不一致");
                        }

                        var encryptPwd = encrypt.encrypt(pwd);
                        post_form.find("input[name=password]").val(encryptPwd);

                        register();
                    } else {
                        alert(result.msg);
                    }

                }, error: function (result) {
                    alert("网络连接失败");
                    registerXhr = null;
                    submitBtn.removeClass("btn-submit");
                }
            });
        }

        function register() {
            registerXhr = $.ajax({
                url: "http://192.168.0.140:8090/api/user/register",
                type: "post",
                data: $("#post-form").serialize(),
                dataType: "json",
				cache: false,
				xhrFields: {withCredentials: true},
                beforeSend: function () {
                },
                complete: function () {
                    registerXhr = null;
                    submitBtn.removeClass("btn-submit");
                },
                success: function (result) {
                    alert(result.msg);
                    if (result.code == 200) {
						alert(result.msg);
						window.location.href = "activity.html";
                        // var backUrl = getQueryVariable("back_url");
                        // window.location.href = backUrl ? backUrl : "/mobile/main";
                    }
                }, error: function (result) {
                    alert("网络连接失败");
                }
            });
        }
    </script>
</body>
</html>